(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"P+Uc":function(o,t,a){"use strict";a.r(t),a.d(t,"TurmaPageModule",function(){return B});var r=a("ofXK"),e=a("3Pt+"),i=a("TEn/"),n=a("tyNb"),l=a("mrSG"),s=a("U73M"),c=a("eZDI"),u=a("fXoL"),d=a("VzdP"),m=a("kmnG"),b=a("qFsG"),h=a("8UY1"),f=a("NFeN"),p=a("d3UM"),v=a("FKr1");function g(o,t){if(1&o&&(u.Sb(0,"mat-option",20),u.rc(1),u.Rb()),2&o){const o=t.$implicit;u.hc("value",o.sigla),u.Cb(1),u.tc(" ",o.nome," ")}}const C=function(){return{mask:"000.000.000-00"}},S=function(){return{mask:"(00) 0000-00000"}},R=function(){return{mask:"00000-000"}};function I(o,t){if(1&o){const o=u.Tb();u.Sb(0,"form",5),u.Sb(1,"mat-form-field",6),u.Sb(2,"mat-label"),u.rc(3,"CPF"),u.Rb(),u.Ob(4,"input",7),u.Sb(5,"mat-icon",8),u.ac("click",function(){return u.mc(o),u.ec().buscarAlunoPorCPF()}),u.rc(6,"search"),u.Rb(),u.Rb(),u.Sb(7,"mat-form-field",6),u.Sb(8,"mat-label"),u.rc(9,"Nome"),u.Rb(),u.Ob(10,"input",9),u.Rb(),u.Sb(11,"mat-form-field",6),u.Sb(12,"mat-label"),u.rc(13,"Email"),u.Rb(),u.Ob(14,"input",10),u.Rb(),u.Sb(15,"mat-form-field",6),u.Sb(16,"mat-label"),u.rc(17,"Fone"),u.Rb(),u.Ob(18,"input",11),u.Rb(),u.Sb(19,"mat-form-field",6),u.Sb(20,"mat-label"),u.rc(21,"CEP"),u.Rb(),u.Ob(22,"input",12),u.Rb(),u.Sb(23,"mat-form-field",6),u.Sb(24,"mat-label"),u.rc(25,"Estado"),u.Rb(),u.Sb(26,"mat-select",13),u.qc(27,g,2,2,"mat-option",14),u.Rb(),u.Rb(),u.Sb(28,"mat-form-field",6),u.Sb(29,"mat-label"),u.rc(30,"Cidade"),u.Rb(),u.Ob(31,"input",15),u.Rb(),u.Sb(32,"mat-form-field",6),u.Sb(33,"mat-label"),u.rc(34,"Bairro"),u.Rb(),u.Ob(35,"input",16),u.Rb(),u.Sb(36,"mat-form-field",6),u.Sb(37,"mat-label"),u.rc(38,"Logradouro"),u.Rb(),u.Ob(39,"input",17),u.Rb(),u.Sb(40,"mat-form-field",6),u.Sb(41,"mat-label"),u.rc(42,"N\xfamero"),u.Rb(),u.Ob(43,"input",18),u.Rb(),u.Sb(44,"mat-form-field",6),u.Sb(45,"mat-label"),u.rc(46,"Complemento"),u.Rb(),u.Ob(47,"input",19),u.Rb(),u.Rb()}if(2&o){const o=u.ec();u.hc("formGroup",o.form),u.Cb(4),u.hc("imask",u.ic(6,C)),u.Cb(14),u.hc("imask",u.ic(7,S)),u.Cb(4),u.hc("imask",u.ic(8,R)),u.Cb(4),u.hc("compareWith",o.compareFn),u.Cb(1),u.hc("ngForOf",o.estados)}}function O(o,t){1&o&&(u.Sb(0,"div",21),u.rc(1,"Falha ao exibir aluno."),u.Rb())}let P=(()=>{class o{constructor(o,t,a){this.modalController=o,this.navParams=t,this.escolasProvider=a,this.estados=c.a,this.loading=!1,this.escolas=[],this.turmas=[],this.disableClose=!1,this.aluno=this.navParams.data.aluno,this.loadFormData()}loadFormData(){return Object(l.a)(this,void 0,void 0,function*(){let o=new e.f({id:new e.d(this.aluno.id,{validators:[]}),matricula:new e.d(this.aluno.matricula,{validators:[e.r.required]}),nome:new e.d(this.aluno.nome,{validators:[e.r.required]}),cpf:new e.d(this.aluno.cpf,{validators:[e.r.required]}),logradouro:new e.d(this.aluno.logradouro,{validators:[e.r.required]}),numero:new e.d(this.aluno.numero,{validators:[e.r.required]}),complemento:new e.d(this.aluno.complemento,{validators:[]}),bairro:new e.d(this.aluno.bairro,{validators:[e.r.required]}),cidade:new e.d(this.aluno.cidade,{validators:[e.r.required]}),estado:new e.d(this.aluno.estado,{validators:[e.r.required]}),cep:new e.d(this.aluno.cep||"",{validators:[e.r.required]}),fone:new e.d(this.aluno.fone,{validators:[e.r.required]}),email:new e.d(this.aluno.email,{validators:[e.r.required]}),serie:new e.d(this.aluno.serie,{validators:[e.r.required]}),turmaId:new e.d(this.aluno.turmaId,{validators:[e.r.required]}),escolaId:new e.d(this.aluno.escolaId,{validators:[e.r.required]})});this.form=o,yield this.listaEscolas()})}updateFormData(){var o,t,a,r,e,i,n,s,c,u,d,m,b,h;return Object(l.a)(this,void 0,void 0,function*(){this.form.controls.id.setValue(null===(o=this.aluno)||void 0===o?void 0:o.id),this.form.controls.matricula.setValue(null===(t=this.aluno)||void 0===t?void 0:t.matricula),this.form.controls.nome.setValue(null===(a=this.aluno)||void 0===a?void 0:a.nome),this.form.controls.cpf.setValue(null===(r=this.aluno)||void 0===r?void 0:r.cpf),this.form.controls.logradouro.setValue(null===(e=this.aluno)||void 0===e?void 0:e.logradouro),this.form.controls.numero.setValue(null===(i=this.aluno)||void 0===i?void 0:i.numero),this.form.controls.complemento.setValue(null===(n=this.aluno)||void 0===n?void 0:n.complemento),this.form.controls.bairro.setValue(null===(s=this.aluno)||void 0===s?void 0:s.bairro),this.form.controls.cidade.setValue(null===(c=this.aluno)||void 0===c?void 0:c.cidade),this.form.controls.estado.setValue(null===(u=this.aluno)||void 0===u?void 0:u.estado),this.form.controls.cep.setValue(null===(d=this.aluno)||void 0===d?void 0:d.cep),this.form.controls.fone.setValue(null===(m=this.aluno)||void 0===m?void 0:m.fone),this.form.controls.email.setValue(null===(b=this.aluno)||void 0===b?void 0:b.email),this.form.controls.serie.setValue(null===(h=this.aluno)||void 0===h?void 0:h.serie),this.form.updateValueAndValidity()})}listaEscolas(){return Object(l.a)(this,void 0,void 0,function*(){try{let o=this.form.controls.escolaId.value;this.escolas=yield this.escolasProvider.listaEscolas(),this.turmas=o?yield this.escolasProvider.listaTurmas({escolaId:o}):[]}catch(o){console.error(o),this.error=o.message||"Erro ao carregar dados do formul\xe1rio"}})}listaTurmas(o){return Object(l.a)(this,void 0,void 0,function*(){try{this.turmas=yield this.escolasProvider.listaTurmas({escolaId:o}),this.turmas.find(o=>o.id==this.form.controls.turmaId.value)||this.form.controls.turmaId.setValue(null)}catch(t){this.error=t.message||"Erro ao carregar dados do formul\xe1rio"}})}closeModal(){return Object(l.a)(this,void 0,void 0,function*(){this.modalController.dismiss({salvo:!1})})}salvar(){return Object(l.a)(this,void 0,void 0,function*(){this.disableClose=!0,this.loading=!0;try{let o=new s.a(this.form.getRawValue());yield this.escolasProvider.salvaAluno(o),this.error=null,this.modalController.dismiss({salvo:!0})}catch(o){this.error=o.message||"Falha ao salvar aluno"}this.loading=!1})}buscarAlunoPorCPF(){return Object(l.a)(this,void 0,void 0,function*(){try{let o=yield this.escolasProvider.buscaAlunoPorCPF(this.form.controls.cpf.value);this.aluno=o,this.updateFormData()}catch(o){alert(o.message||"Falha ao buscar aluno")}})}compareFn(o,t){return o==t}}return o.\u0275fac=function(t){return new(t||o)(u.Nb(i.r),u.Nb(i.s),u.Nb(d.a))},o.\u0275cmp=u.Hb({type:o,selectors:[["page-aluno-modal"]],decls:13,vars:3,consts:[[1,"ion-padding"],[3,"formGroup",4,"ngIf"],["class","error",4,"ngIf"],["ion-button","","slot","end","shape","round","fill","clear","type","button","color","dark",1,"ion-margin",3,"click"],["ion-button","","slot","end","shape","round","fill","clear","type","button","color","primary",1,"ion-margin",3,"disabled","click"],[3,"formGroup"],[1,"campo"],["matInput","","type","text","formControlName","cpf",3,"imask"],["matSuffix","",3,"click"],["matInput","","type","text","formControlName","nome"],["matInput","","type","email","formControlName","email"],["matInput","","type","tel","formControlName","fone",3,"imask"],["matInput","","type","text","formControlName","cep",3,"imask"],["formControlName","estado",3,"compareWith"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","text","formControlName","cidade"],["matInput","","type","text","formControlName","bairro"],["matInput","","type","text","formControlName","logradouro"],["matInput","","type","number","formControlName","numero"],["matInput","","type","text","formControlName","complemento"],[3,"value"],[1,"error"]],template:function(o,t){1&o&&(u.Sb(0,"ion-header"),u.Sb(1,"ion-toolbar"),u.Sb(2,"ion-title"),u.rc(3,"Aluno"),u.Rb(),u.Rb(),u.Rb(),u.Sb(4,"ion-content",0),u.qc(5,I,48,9,"form",1),u.qc(6,O,2,0,"div",2),u.Rb(),u.Sb(7,"ion-footer"),u.Sb(8,"ion-toolbar"),u.Sb(9,"ion-button",3),u.ac("click",function(){return t.closeModal()}),u.rc(10,"Sair"),u.Rb(),u.Sb(11,"ion-button",4),u.ac("click",function(){return t.salvar()}),u.rc(12,"Salvar"),u.Rb(),u.Rb(),u.Rb()),2&o&&(u.Cb(5),u.hc("ngIf",t.form),u.Cb(1),u.hc("ngIf",!t.aluno),u.Cb(5),u.hc("disabled",t.disableClose))},directives:[i.h,i.o,i.n,i.f,r.j,i.g,i.d,e.s,e.m,e.g,m.b,m.e,b.a,e.c,e.l,e.e,h.a,f.a,m.f,p.a,r.i,e.p,v.e],encapsulation:2}),o})();var w=a("jG7P"),y=a("fb0m"),M=a("bSwM");function F(o,t){1&o&&(u.Sb(0,"h1"),u.rc(1,"Dados da Turma"),u.Rb())}function k(o,t){if(1&o&&(u.Sb(0,"form",8),u.Sb(1,"mat-form-field",9),u.Sb(2,"mat-label"),u.rc(3,"Numero"),u.Rb(),u.Ob(4,"input",10),u.Rb(),u.Sb(5,"mat-form-field",9),u.Sb(6,"mat-label"),u.rc(7,"Serie"),u.Rb(),u.Ob(8,"input",11),u.Rb(),u.Sb(9,"mat-checkbox",12),u.rc(10,"Ativa"),u.Rb(),u.Rb()),2&o){const o=u.ec(2);u.hc("formGroup",o.form)}}function q(o,t){if(1&o){const o=u.Tb();u.Sb(0,"ion-toolbar"),u.Sb(1,"ion-title"),u.rc(2,"Alunos"),u.Rb(),u.Sb(3,"ion-button",13),u.ac("click",function(){return u.mc(o),u.ec(2).criarAluno()}),u.Ob(4,"ion-icon",14),u.Rb(),u.Rb()}}function N(o,t){if(1&o){const o=u.Tb();u.Sb(0,"ion-searchbar",15),u.ac("ngModelChange",function(t){return u.mc(o),u.ec(2).textoBusca=t})("ionChange",function(){return u.mc(o),u.ec(2).filtraAlunos()}),u.Rb()}if(2&o){const o=u.ec(2);u.hc("ngModel",o.textoBusca)}}const _=function(){return["hoverable","pointable"]};function V(o,t){if(1&o){const o=u.Tb();u.Sb(0,"ion-item",17),u.ac("click",function(){u.mc(o);const a=t.$implicit;return u.ec(3).abrirModalAluno(a)}),u.Sb(1,"div",18),u.Sb(2,"div",19),u.rc(3),u.Rb(),u.Sb(4,"div",20),u.rc(5),u.Rb(),u.Sb(6,"div",21),u.rc(7),u.Rb(),u.Sb(8,"div",22),u.rc(9),u.Rb(),u.Rb(),u.Rb()}if(2&o){const o=t.$implicit;u.hc("ngClass",u.ic(5,_)),u.Cb(3),u.sc(o.nome),u.Cb(2),u.tc("Matr\xedcula: ",o.matricula,""),u.Cb(2),u.sc(o.fone),u.Cb(2),u.sc(o.email)}}function x(o,t){if(1&o&&(u.Sb(0,"ion-list"),u.qc(1,V,10,6,"ion-item",16),u.Rb()),2&o){const o=u.ec(2);u.Cb(1),u.hc("ngForOf",o.alunosFiltrados)}}function T(o,t){if(1&o){const o=u.Tb();u.Sb(0,"div"),u.qc(1,F,2,0,"h1",3),u.qc(2,k,11,1,"form",4),u.Sb(3,"ion-toolbar"),u.Sb(4,"ion-button",5),u.ac("click",function(){return u.mc(o),u.ec().resetarFormulario()}),u.rc(5," Desfazer "),u.Rb(),u.Sb(6,"ion-button",6),u.ac("click",function(){return u.mc(o),u.ec().salvarFormulario()}),u.rc(7," Salvar "),u.Rb(),u.Rb(),u.qc(8,q,5,0,"ion-toolbar",3),u.qc(9,N,1,1,"ion-searchbar",7),u.qc(10,x,2,1,"ion-list",3),u.Rb()}if(2&o){const o=u.ec();u.Cb(1),u.hc("ngIf",o.form),u.Cb(1),u.hc("ngIf",o.form),u.Cb(6),u.hc("ngIf",o.turmaId),u.Cb(1),u.hc("ngIf",o.turmaId&&o.alunos&&o.alunos.length&&o.turma&&o.turma.id),u.Cb(1),u.hc("ngIf",o.turmaId&&o.alunos&&o.alunos.length&&o.turma&&o.turma.id)}}function A(o,t){if(1&o&&(u.Sb(0,"div"),u.rc(1),u.Rb()),2&o){const o=u.ec();u.Cb(1),u.sc(o.error)}}function j(o,t){1&o&&(u.Sb(0,"div"),u.rc(1,"Carregando..."),u.Rb())}const D=[{path:"",component:(()=>{class o{constructor(o,t,a,r){this.router=o,this.activatedRoute=t,this.escolasProvider=a,this.modalController=r,this.loading=!1,this.alunosFiltrados=[],this.textoBusca="",this.turmaId=this.activatedRoute.snapshot.paramMap.get("turmaId"),this.escolaId=this.activatedRoute.snapshot.paramMap.get("escolaId"),!this.turmaId&&this.escolaId?this.criaTurma():this.carregaTurma()}criaTurma(){return Object(l.a)(this,void 0,void 0,function*(){this.turma=new y.a({escolaId:this.escolaId}),this.loadForm()})}carregaTurma(){return Object(l.a)(this,void 0,void 0,function*(){this.loading=!0,this.error=null;try{let{escola:o,turma:t,alunos:a}=yield this.escolasProvider.buscaTurma(this.turmaId);this.escola=o,this.turma=t,this.loadForm(),this.alunos=a,this.filtraAlunos(),this.error=""}catch(o){this.error=o.message||"Falha ao buscar aluno."}this.loading=!1})}loadForm(){this.turma&&(this.form=new e.f({id:new e.d(this.turma.id,{validators:[]}),numero:new e.d(this.turma.numero,{validators:[]}),serie:new e.d(this.turma.serie,{validators:[]}),ativa:new e.d(this.turma.ativa,{validators:[]}),escolaId:new e.d(this.turma.escolaId,{validators:[]})}))}filtraAlunos(){if(this.textoBusca){const o=new w.a(this.alunos,["matricula","nome","email","fone"],{caseSensitive:!1});this.alunosFiltrados=o.search(this.textoBusca)}else this.alunosFiltrados=this.alunos}abrirModalAluno(o){return Object(l.a)(this,void 0,void 0,function*(){if(this.turmaId&&o){const t=yield this.modalController.create({component:P,cssClass:"aluno-modal-page",backdropDismiss:!1,componentProps:{aluno:o}});return t.onDidDismiss().then(o=>{o.data.salvo&&this.carregaTurma()}),yield t.present()}})}criarAluno(){var o;this.turmaId&&this.abrirModalAluno(new s.a({turmaId:this.turmaId,escolaId:null===(o=this.escola)||void 0===o?void 0:o.id}))}buscarAluno(){}salvarFormulario(){return Object(l.a)(this,void 0,void 0,function*(){try{let o=new y.a(this.form.getRawValue());o=yield this.escolasProvider.salvaTurma(o),this.turma=o,this.turmaId||(this.turmaId=o.id,this.router.navigate(["/turma",o.id],{replaceUrl:!0}),this.alunos=[])}catch(o){alert(o.message||"Falha ao salvar turma.")}})}resetarFormulario(){this.turma&&(this.form.controls.id.setValue(this.turma.id),this.form.controls.numero.setValue(this.turma.numero),this.form.controls.serie.setValue(this.turma.serie),this.form.controls.ativa.setValue(this.turma.ativa),this.form.controls.escolaId.setValue(this.turma.escolaId))}compareFn(o,t){return o==t}}return o.\u0275fac=function(t){return new(t||o)(u.Nb(n.g),u.Nb(n.a),u.Nb(d.a),u.Nb(i.r))},o.\u0275cmp=u.Hb({type:o,selectors:[["app-turma"]],decls:10,vars:4,consts:[["slot","start"],[3,"defaultHref"],[1,"ion-padding"],[4,"ngIf"],["class","form-escola",3,"formGroup",4,"ngIf"],["ion-button","","shape","round","fill","clear","type","button","color","dark",1,"ion-margin",3,"click"],["ion-button","","shape","round","fill","clear","type","button","color","primary",1,"ion-margin",3,"click"],["placeholder","Buscar Alunos",3,"ngModel","ngModelChange","ionChange",4,"ngIf"],[1,"form-escola",3,"formGroup"],[1,"campo"],["matInput","","type","text","formControlName","numero"],["matInput","","type","number","formControlName","serie"],["formControlName","ativa",1,"campo"],["ion-button","","slot","end","shape","round","fill","clear","type","button","color","dark",1,"ion-margin",3,"click"],["name","add-sharp"],["placeholder","Buscar Alunos",3,"ngModel","ngModelChange","ionChange"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ngClass","click"],[1,"conteudo-item"],[1,"nome"],[1,"matricula"],[1,"fone"],[1,"email"]],template:function(o,t){1&o&&(u.Sb(0,"ion-header"),u.Sb(1,"ion-toolbar"),u.Sb(2,"ion-buttons",0),u.Ob(3,"ion-back-button",1),u.Rb(),u.Sb(4,"ion-title"),u.rc(5,"Turma"),u.Rb(),u.Rb(),u.Rb(),u.Sb(6,"ion-content",2),u.qc(7,T,11,5,"div",3),u.qc(8,A,2,1,"div",3),u.qc(9,j,2,0,"div",3),u.Rb()),2&o&&(u.Cb(3),u.hc("defaultHref",t.escola?"/escola/"+t.escola.id:"/"),u.Cb(4),u.hc("ngIf",!t.loading&&!t.error),u.Cb(1),u.hc("ngIf",t.error&&!t.loading),u.Cb(1),u.hc("ngIf",t.loading))},directives:[i.h,i.o,i.e,i.b,i.c,i.n,i.f,r.j,i.d,e.s,e.m,e.g,m.b,m.e,b.a,e.c,e.l,e.e,e.p,M.a,i.i,i.m,i.u,e.o,i.k,r.i,i.j,r.h],styles:[".hoverable[_ngcontent-%COMP%]:hover{background-color:#f3f3f3}.pointable[_ngcontent-%COMP%]{cursor:pointer}.form-escola[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto;grid-gap:8px}@media (min-width:768px){.form-escola[_ngcontent-%COMP%]{grid-template-columns:auto auto auto}}.conteudo-item[_ngcontent-%COMP%]{width:100%;display:grid}.conteudo-item[_ngcontent-%COMP%]   .busca[_ngcontent-%COMP%], .conteudo-item[_ngcontent-%COMP%]   .email[_ngcontent-%COMP%], .conteudo-item[_ngcontent-%COMP%]   .fone[_ngcontent-%COMP%], .conteudo-item[_ngcontent-%COMP%]   .matricula[_ngcontent-%COMP%], .conteudo-item[_ngcontent-%COMP%]   .nome[_ngcontent-%COMP%]{padding:8px;display:grid}.conteudo-item[_ngcontent-%COMP%]   .nome[_ngcontent-%COMP%]{font-size:larger;font-weight:600}@media (min-width:0){.conteudo-item[_ngcontent-%COMP%]{grid-template-columns:1fr;grid-template-rows:auto auto auto}}@media (min-width:1200px){.conteudo-item[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr 1fr 1fr;grid-template-rows:auto}.conteudo-item[_ngcontent-%COMP%]   .nome[_ngcontent-%COMP%]{grid-column:1/2}.conteudo-item[_ngcontent-%COMP%]   .matricula[_ngcontent-%COMP%]{grid-column:2/3}.conteudo-item[_ngcontent-%COMP%]   .fone[_ngcontent-%COMP%]{grid-column:3/4}.conteudo-item[_ngcontent-%COMP%]   .email[_ngcontent-%COMP%]{grid-column:4/5}}"]}),o})()}];let G=(()=>{class o{}return o.\u0275mod=u.Lb({type:o}),o.\u0275inj=u.Kb({factory:function(t){return new(t||o)},imports:[[n.i.forChild(D)],n.i]}),o})();var E=a("bTqV");let B=(()=>{class o{}return o.\u0275mod=u.Lb({type:o}),o.\u0275inj=u.Kb({factory:function(t){return new(t||o)},imports:[[r.b,e.h,i.p,G,e.q,b.b,m.d,p.b,f.b,E.a,M.b,h.b]]}),o})()}}]);